<!DOCTYPE html>
<html>

  <script type="text/javascript" src="/assets/app.js"></script>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta content="Wasin's Blog" property="og:site_name">

    <title>Model & Approach for Private Delivery of iOS Frameworks Using Cocoapods</title>
    <meta name="description" content="I blog about projects I'm working on. Mostly about mobile games, tech, web service, little tiny things I built for myself or for public, and tech/game industry-wide. Currently I'm living in Shenzhen, China. I'm running a small creative company with my girlfriend here.
">
    
        <meta content="Model & Approach for Private Delivery of iOS Frameworks Using Cocoapods" property="og:title">
    

    
        <meta content="article" property="og:type">
    
    
        <meta content="Lately, I&#39;ve been thinking about the way to deliver private iOS frameworks to users using Cocoapods.
" property="og:description">
    
    
        <meta content="http://blog.wasin.io/blog/2017/03/25/model-and-approach-for-private-delivery-of-ios-frameworks-using-cocoapods.html" property="og:url">
    
    
        <meta content="2017-03-25T00:03:00+08:00" property="article:published_time">
        <meta content="http://blog.wasin.io" property="article:author">
    
    
        <meta content="http://blog.wasin.io/assets/images/haxpor_avatar.jpg" property="og:image">
    
    
        
        <meta content="blog" property="article:section">
        
    
    
        
        <meta content="cocoapods" property="article:tag">
        
        <meta content="pod" property="article:tag">
        
        <meta content="private" property="article:tag">
        
        <meta content="framework" property="article:tag">
        
        <meta content="ios" property="article:tag">
        
        <meta content="model" property="article:tag">
        
    

    <link rel="canonical" href="http://blog.wasin.io/blog/2017/03/25/model-and-approach-for-private-delivery-of-ios-frameworks-using-cocoapods.html">
    <link rel="stylesheet" href="/css/vendor/weui.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <link rel="stylesheet" type="text/css" href="
https://cdnjs.cloudflare.com/ajax/libs/mermaid/6.0.0/mermaid.css">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/6.0.0/mermaid.min.js"></script>
	<script type="text/javascript">mermaid.initialize({startOnLoad:true});</script>
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title-white-bold" href=""/>Wasin</a><a class="site-title" href="/">'s Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon" id="hamburgerBtn" onClick="if (window.getComputedStyle(this).getPropertyValue('display') != 'none') { showMainPagePicker('http://dashboard.wasin.io'); }">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="http://dashboard.wasin.io">Back to Dashboard</a>
        
      </div>
    </nav>
  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Model & Approach for Private Delivery of iOS Frameworks Using Cocoapods</h1>
    <p class="post-meta">Mar 25, 2017</p>
  </header>

  <article class="post-content">
    <p>Lately, I&#39;ve been thinking about the way to deliver <strong>private</strong> iOS frameworks to users using <a href="https://cocoapods.org/">Cocoapods</a>.</p>

<p>Firstly, don&#39;t get me wrong, I do love open source, I embrace the way of its approach, and even put tagline <em>Open source by default</em> on my <a href="https://twitter.com/haxpor">Twitter profile</a>. Yup, I do understand that not every situation or entity can go all-in with such approach. There will be certain circumstance that the project needs to be in closed-source forever, or for certain time period until it can be open, or due to as part of the deal that makes open source is not an option.</p>

<p>Whatever the reason it might be, having Cocoapods as your delivery and dependency management is still a leading choice. I do point it out because if we&#39;re going to deliver frameworks privately through Cocoapod, there&#39;s going to be additional effort.</p>

<p>Let&#39;s first understand the underlying system of Cocoapods, until we come to overall big picture of model to use it.</p>

<h2 id="underlying">Underlying</h2>

<hr>

<p>Under the hood, there are 2 main things that work together for Cocoapods.</p>

<ol>
<li><code>Specs</code> repo</li>
<li><code>.podspec</code> files</li>
</ol>

<p><code>Specs</code> repo contains multiple <code>.podspec</code> files. Main <a href="https://github.com/CocoaPods/Specs">Spec repo</a> of Cocoapods is used to serve general public frameworks to users. Your <code>pod install</code> command will check to see information from this repo, and go down to check <code>.podspec</code> file for specific version of target framework in order to know URL to pull down framework&#39;s source code then finally integrate it with your Xcode project. See example of <code>.podspec</code> file <a href="https://github.com/CocoaPods/Specs/blob/master/Specs/d/a/2/Alamofire/4.4.0/Alamofire.podspec.json">here</a>.</p>

<p>You notice that Spec repo is public, thus also <code>.podspec</code> file. Anyone can take a peek, and get relavent information. Now you see the problem that such information can lead to information breached in term of closed-source approach. They might get to know which client you work with, or github URL. With those two information, competitors can imply or even try to download the project source code (if permission is not set properly, yup github project as served on Cocoapods can be set to be private. It&#39;s just a matter how who can access.).</p>

<p><a id="steps"></a>What we need to do is</p>

<ol>
<li>Self-host <code>Specs</code> repo</li>
<li>Build framework in universal binary without exposing source code</li>
<li>Upload result framework to public server for user to grab</li>
<li>Create a proper <code>.podspec</code> file and set its <code>source</code> field to use URL as result from 3.</li>
</ol>

<h3 id="self-host-spec-repo">Self-host Spec repo</h3>

<p>To gain the benefit of setting the permission of <code>Specs</code> repo, you have only option which is to do self-host of it.
Even you do self-host, you also have an option of setting access permission to be in public or private. In this case, we&#39;re primarily interested in private access.</p>

<p>Cocoapods has official document on <a href="https://guides.cocoapods.org/making/private-cocoapods.html">how to host private Specs repo</a>.</p>

<h3 id="build-framework-in-universal-binary-without-exposing-source-code">Build framework in universal binary without exposing source code</h3>

<p>I came across this well explained <a href="https://eladnava.com/publish-a-universal-binary-ios-framework-in-swift-using-cocoapods/">article</a> of how to publish a universal binary iOS framework using Cocoapods.</p>

<p>Only difference from what we&#39;re trying achieving compared to that article is that, the author publishes it publicly. But we want it in private. Thus we have no need to involve using <code>pod trunk ...</code> command as we don&#39;t publish to the main public <code>Specs</code> repo but to our private one.</p>

<h3 id="upload-result-framework-to-public-server">Upload result framework to public server</h3>

<p>Upload such built frameworks to our public server. Ensure that it&#39;s in universal binary form thus it can be used to run on device and simulator. Ensure that you didn&#39;t include any source code with it. Normally, aim for <code>.zip</code> file. The content of <code>.zip</code> file mainly contains <code>.framework</code> along with <code>README</code> or any relavent files if you need. All of them are at the same level. It might be as follows.</p>
<div class="highlight"><pre><code class="language-" data-lang="">framework-result.zip
               |_ myFW.framework
               |_ README
               |_ strip-frameworks.sh
</code></pre></div>
<blockquote>
<p><code>strip-frameworks.sh</code> is usually needed at the end when users want to publish the result application to AppStore. It will help stripping un-needed architecture from frameworks being in use. You can see and make use of <a href="https://github.com/realm/realm-cocoa/blob/master/scripts/strip-frameworks.sh">strip-frameworks.sh</a> by Realm. Insert it insidee <em>Build Phases</em>.</p>
</blockquote>

<h3 id="create-a-proper-podspec-file">Create a proper <code>.podspec</code> file</h3>

<p>Properly create a <code>.podspec</code> file to match the version of such framework. The most important thing is <code>source</code> field instead of providing github URL, you provide the end-result of URL of <code>.zip</code> for users to download.</p>

<h2 id="model">Model</h2>

<hr>

<p>Now it&#39;s time for a big picture to see how everything gets involved.
Please note that I observe the main <code>Specs</code> repo&#39;s file structure then compare with our private one, there is slightly difference. So I include it here too.</p>

<p><strong>Main <code>Specs</code> repo</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">Specs
  |_ 0
     |_ 0
         |_ framework-A
                   |_ 1.0.0
                         |_ framework-A.podspec
                   |_ 1.0.1
                         |_ framework-A.podspec
                   |_ 1.1.0
                         |_ framework-A.podspec
         |_ framework-B
                   |_ 1.0.0
                         |_ framework-B.podspec
         |_ 1
            |_ ...
         |_ 2
            |_ ...
    |_ 1
       |_ 0
          |_ ...
</code></pre></div>
<p><strong>Our private <code>Specs</code> repo</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">Specs
   |_ framework-A
       |_ 1.0.0
           |_ framework-A.podspec
       |_ 1.0.1
           |_ framework-A.podspec
       |_ 1.1.0
           |_ framework-A.podspec
   |_ framework-B
       |_ 1.0.0
           |_ framework-B.podspec
</code></pre></div>
<p>I cloned the project and inspected, the following is what I found.</p>

<ul>
<li>Each directory holds up to 40 MB</li>
<li>There are 3 layers of numerical directory for each framework to reside in i.e. <code>Specs/0/0/0/framework-A</code>, <code>Specs/0/1/0/framework-B</code></li>
<li>Each layer of numerical directory consists of directory ranging from <code>0</code> to <code>9</code>, also <code>a</code> to <code>f</code> in total of 16 directories</li>
<li>(as above for what I&#39;ve found) <code>Specs</code> repo can hold up to 163.84 GB in total. Right now it&#39;s at 583 MB (0.584 GB) or 0.003%. I suspect this part is to optimize the directory system, not to make each individual directory too large</li>
</ul>

<p>I came up with two possible models; Variant A, and B.</p>

<h3 id="variant-a">Variant A</h3>

<p><img src="/assets/images/cocoapods/VariantA.png" alt="Model Variant A"></p>

<h4 id="annotations">Annotations</h4>

<p><strong>1</strong> ---&gt; Ownership (included just to show authentic owenership)<br>
<strong>2</strong> ---&gt; Public server to host built (.zip) frameworks<br>
<strong>3</strong> ---&gt; Each circle is <strong>private</strong> <code>Specs</code> repo exposed to selected external party (client)<br>
<strong>4</strong> ---&gt; Multiple of client parties spanning into multiple groups</p>

<h4 id="requirements">Requirements</h4>

<ol>
<li>Public server to host built (.zip) frameworks.</li>
<li>Paid Github acccount to have ability to create private repositories ($7/month)</li>
</ol>

<h4 id="feature">Feature</h4>

<p>It allows another layer to control which party (client) can see such <code>Specs</code> repo.
Imagine if we have 2 clients. Each client might use multiple of frameworks and are different from ones used by another client.<br>
Thus we will have 2 private <code>Specs</code> repo one for each client.</p>

<p>We need to allow users (github account) to have read access towards such <code>Specs</code> repo. So when they pull down via configured <code>Podfile</code>, it will be fine.</p>

<h4 id="summary">Summary</h4>

<h5 id="pros">Pros</h5>

<ul>
<li>Additional layer to manage and control which party can have access to which frameworks via private <code>Specs</code> repo.</li>
</ul>

<h5 id="cons">Cons</h5>

<ul>
<li>Need to manage and allow access for users towards such <code>Specs</code> repo</li>
<li>Might not be feasible for who which doesn&#39;t want to pay monthly in order to use Github&#39;s private repositories feature</li>
</ul>

<h3 id="variant-b">Variant B</h3>

<p><img src="/assets/images/cocoapods/VariantB.png" alt="Model Variant B"></p>

<h4 id="annotations">Annotations</h4>

<p><strong>1</strong> ---&gt; Ownership (included just to show authentic owenership)<br>
<strong>2</strong> ---&gt; Public server to host built (.zip) frameworks<br>
<strong>3</strong> ---&gt; One single <code>Specs</code> repo exposed to general public<br>
<strong>4</strong> ---&gt; Multiple of client parties treated as a single public group</p>

<h4 id="requirement">Requirement</h4>

<ol>
<li>Public server to host built (.zip) frameworks.</li>
</ol>

<h4 id="feature">Feature</h4>

<p>It has no control layer over which party or users should have access towards our framework.
Thus there is no need to create private <code>Specs</code> repo and manage (allow users access) to it.</p>

<p>One caveat is that if users inspect the content inside <code>Specs</code> repo, they will have information for all frameworks we have, and might be able to know which client we work with. But it might be less likely for normal users as when they&#39;re done with configuring <code>Podfile</code>, usually they have no time or interest to study our <code>Specs</code> repo. Even if they do so, they have to try by trial and error to use the framework as most likely we will deliver document to client privately too.</p>

<h4 id="summary">Summary</h4>

<h5 id="pros">Pros</h5>

<ul>
<li>No additional effort to manage each private <code>Specs</code> repository as there is none to manage.</li>
<li>No additional cost, normal Github account will do the work</li>
</ul>

<h5 id="cons">Cons</h5>

<ul>
<li>Users might gain information about our all frameworks and where to download; and possible to know which client we&#39;ve worked with.</li>
</ul>

<h2 id="final-words">Final words</h2>

<p>Now we get to know models to use in delivery frameworks to clients privately, and even has options to choose one that is more suitable to use. To go further than that, it&#39;s possible to reduce <a href="#steps">steps</a> needed especially 2, 3, and 4 which are building framework, uploading, and creating a proper <code>.podspec</code> via automated script.</p>

<p>Then even more advanced, for build step, we can make it more robust using automated build system (CI). The overall combination should be pleasant and extremely automated.</p>

<p>I might consider writing about automated build, and how to combine it with models we&#39;ve learned for next articles. For now, we have models and technical background included with steps to accomplish as a foundation to further utilize Cocoapod in delivery and automated flow.</p>

<p>Until next time...</p>

  </article>

  
  	<span class="post-tags">Tags</span>:
  	cocoapods, framework, ios, model, pod, private
	

  
<div id="disqus_thread" style="margin-top: 30px;"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = "http://blog.wasin.io/blog/2017/03/25/model-and-approach-for-private-delivery-of-ios-frameworks-using-cocoapods.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/blog/2017/03/25/model-and-approach-for-private-delivery-of-ios-frameworks-using-cocoapods"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://wasin-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>

      </div>
    </div>

    <a href="/feed.xml" class="weui-btn weui-btn_primary" style="border-radius: 0px">subscribe via RSS</a>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Wasin's Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Wasin's Blog</li>
          <li><a href="mailto:haxpor@gmail.com">haxpor@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/haxpor">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/haxpor">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://instagram.com/haxpor">
              <span class="icon  icon--instagram">
                <svg viewBox="0 0 512 512">
                  <g>
                    <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/>
                    <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/>
                    <circle cx="351.5" cy="160.5" r="21.5"/>
                  </g>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">I blog about projects I'm working on. Mostly about mobile games, tech, web service, little tiny things I built for myself or for public, and tech/game industry-wide. Currently I'm living in Shenzhen, China. I'm running a small creative company with my girlfriend here.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>
</html>
