<!DOCTYPE html>
<html>

  <script type="text/javascript" src="/assets/app.js"></script>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta content="Wasin's Blog" property="og:site_name">

    <title>Hands-On Fastlane</title>
    <meta name="description" content="I blog about projects I'm working on. Mostly about mobile games, tech, web service, little tiny things I built for myself or for public, and tech/game industry-wide. Currently I'm living in Shenzhen, China. I'm running a small creative company with my girlfriend here.
">
    
        <meta content="Hands-On Fastlane" property="og:title">
    

    
        <meta content="article" property="og:type">
    
    
        <meta content="I see the pain from colleagues I&#39;ve worked with at the company I&#39;ve contracted. The pain comes from on-demand build as requested from clients or even internal team.
" property="og:description">
    
    
        <meta content="http://blog.wasin.io/blog/2017/01/15/hands-on-fastlane.html" property="og:url">
    
    
        <meta content="2017-01-15T18:41:00+08:00" property="article:published_time">
        <meta content="http://blog.wasin.io" property="article:author">
    
    
        <meta content="http://blog.wasin.io/assets/images/haxpor_avatar.jpg" property="og:image">
    
    
        
        <meta content="blog" property="article:section">
        
    
    
        
        <meta content="ios" property="article:tag">
        
        <meta content="fastlane" property="article:tag">
        
        <meta content="automation" property="article:tag">
        
        <meta content="integration" property="article:tag">
        
        <meta content="script" property="article:tag">
        
    

    <link rel="canonical" href="http://blog.wasin.io/blog/2017/01/15/hands-on-fastlane.html">
    <link rel="stylesheet" href="/css/vendor/weui.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <link rel="stylesheet" type="text/css" href="
https://cdnjs.cloudflare.com/ajax/libs/mermaid/6.0.0/mermaid.css">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/6.0.0/mermaid.min.js"></script>
	<script type="text/javascript">mermaid.initialize({startOnLoad:true});</script>
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <a class="site-title-white-bold" href=""/>Wasin</a><a class="site-title" href="/">'s Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon" id="hamburgerBtn" onClick="if (window.getComputedStyle(this).getPropertyValue('display') != 'none') { showMainPagePicker('http://dashboard.wasin.io'); }">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        <a class="page-link" href="http://dashboard.wasin.io">Back to Dashboard</a>
        
      </div>
    </nav>
  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Hands-On Fastlane</h1>
    <p class="post-meta">Jan 15, 2017</p>
  </header>

  <article class="post-content">
    <p>I see the pain from colleagues I&#39;ve worked with at the company I&#39;ve contracted. The pain comes from on-demand build as requested from clients or even internal team.</p>

<p>Each building process requires significant time that can damage and waste the productivity of the team. Instead of investing time to do repeatitive task which could be used elsewhere.</p>

<p>I heard about <em>Fastlane</em> for quite some time. Unfortunately, for myself I didn&#39;t have a reasonable chance to use it to fasten my workflow as most of the time I work with the codebase alone. Thus I did some research and tested the tool to see how can we benefit from it.</p>

<h2 id="fastlane">Fastlane</h2>

<p><a href="http://fastlane.tools/">Fastlane</a> is an automated tools comprising of multiple sub-tools to help in each area of Apple App Development Workflow.</p>

<p><img src="/assets/images/fastlane/fastlane-logo.png" alt="Fastlane logo"></p>

<p>What we&#39;re going to do is to create a simple 2 pages iOS application. Each page can switch back and forth to each other. There are simple text fields and buttons on those pages. We&#39;re going to test the following areas as provided by the tool</p>

<ul>
<li>Register application and manage certificate on Apple Developer Website</li>
<li>Run Tests and UI Tests</li>
<li>Take screenshots</li>
<li>Submit application to beta testers on Testflight</li>
</ul>

<p>This means we will need to set up our Xcode project properly to have working storyboard, have Tests &amp; UI Tests code, and localize the application for 3 languages (English, French, and Simplified Chinese). By all means to test Fastlane workflow.</p>

<p>Our interested areas to test seems to cover most of what normal use cases in development workflow could be. Let&#39;s get into it.</p>

<h2 id="install-fastlane">Install Fastlane</h2>

<p>I&#39;m using macOS <code>10.12.3 Beta</code> as a testing system, along with Xcode <code>8.2</code>.</p>

<p>Now install Fastlane by executing <code>sudo gem install fastlane</code>.
As of this writing, version is <code>2.5.0</code>.</p>

<p>Check the installation result by executing <code>fastlane --version</code>, you should be able to see something similar to this.</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">fastlane installation at path:
/usr/local/lib/ruby/gems/2.2.0/gems/fastlane-2.5.0/bin/fastlane
-----------------------------
fastlane 2.5.0
</code></pre></div>
<h2 id="create-a-testing-ios-project">Create a Testing iOS Project</h2>

<p>We need to create a testing iOS project first.</p>

<p>Now create a new iOS project with project type &quot;Single View Application&quot;</p>

<p><img src="/assets/images/fastlane/fastlane-create-project-1.png" alt="create a new project with single view application type"></p>

<p>Next, enter <em>Product Name</em>, and tick to enable <em>Include Unit Tests</em> and <em>Include UI Tests</em>.</p>

<p><img src="/assets/images/fastlane/fastlane-create-project-2.png" alt="set new project options"></p>

<p>Set up your storyboard to be similar to the following. Only for 2nd <code>UIViewController</code> in which you need to assign its class to <code>ViewController.swift</code> as we will link a button click later.</p>

<p><img src="/assets/images/fastlane/ios-storyboard.png" alt="storyboard setup"></p>

<p>We need to link button of first <code>UIViewController</code> to show second <code>UIViewController</code> modally. This can be easily done by holding <code>Ctrl</code> then clicking on the button, dragging it to second <code>UIViewController</code> then finally releasing the mouse button. It will show a pop-up asking which way you&#39;re going to present it. Select &quot;Present Modally&quot;.</p>

<p><img src="/assets/images/fastlane/ios-storyboard-present-modally.png" alt="storyboard-present-modally"></p>

<p>Linking a button on second <code>UIViewController</code> needs a little bit of effort. You need to display Assistant Editor by hitting <code>Cmd</code> + <code>Option</code> + <code>Delete</code>. </p>

<p>Linking a button for its clicking action by holding down <code>Ctrl</code> button then clicking on the button and draggraing it onto the empty space of <code>ViewController.swift</code> file. The source code of <code>ViewController.swift</code> should have the following</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">didReceiveMemoryWarning</span><span class="p">()</span>
        <span class="c1">// Dispose of any resources that can be recreated.</span>
    <span class="p">}</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">onClickBackButton</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span> <span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> 
            <span class="kt">NSLog</span><span class="p">(</span><span class="s">"completed dismiss"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>With all these, we have basic UI elements that we need and each page can present another page; back and forth.</p>

<h2 id="localize-ios-application">Localize iOS Application</h2>

<p>Click on project name and add <em>Simplified Chinese</em>, and <em>French</em> for our additional localized language while <em>English</em> is the main development language.</p>

<p><img src="/assets/images/fastlane/project-setup-localization.png" alt="project set up for localization"></p>

<p>Now when you look at the <em>Project navigator</em> panel on the left, and click to expand main storyboard file. You will see something like this.</p>

<p><img src="/assets/images/fastlane/expanded-main-storyboard-file.png" alt="expanded main storyboard file"></p>

<p>Click on each language one by one to edit its translated text for UI elements which are labels, and buttons that we have on our storyboard. Feel free to just use Google translator service or any service you have. But don&#39;t just lazily put English text in it for all languages, we will see real result of this later after we run Fastlane.</p>

<h2 id="add-tests-ui-tests">Add Tests &amp; UI Tests</h2>

<p>Before we proceed to using Fastlane tool. We will create Tests and UI Tests first. This will be used as part of Fastlane Workflow.</p>

<h3 id="tests">Tests</h3>

<p>For simplicity as we don&#39;t really have meaningful things to test, we just assert for true. You should have code as follows in <code>FastlaneTestTests.swift</code> file.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">XCTest</span>
<span class="kd">@testable</span> <span class="kd">import</span> <span class="kt">FastlaneTest</span>

<span class="kd">class</span> <span class="kt">FastlaneTestTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">setUp</span><span class="p">()</span>
        <span class="c1">// Put setup code here. This method is called before the invocation of each test method in the class.</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tearDown</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Put teardown code here. This method is called after the invocation of each test method in the class.</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">testExample</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is an example of a functional test case.</span>
        <span class="c1">// Use XCTAssert and related functions to verify your tests produce the correct results.</span>
        <span class="kt">XCTAssert</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="ui-tests">UI Tests</h3>

<p>Not only for testing purpose but UI Tests is also the building block to automate taking screenshots as part of Fastlane workflow. Thus we will add real testing code here.</p>

<p>Inside <code>FastlaneTestUITests.swift</code>, add the following functions for each UI test case.</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift">  <span class="kd">func</span> <span class="nf">testUsernameIsWasin</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">firstnametextfieldTextField</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span><span class="o">.</span><span class="n">textFields</span><span class="p">[</span><span class="s">"firstNameTextField"</span><span class="p">]</span>
        <span class="n">firstnametextfieldTextField</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        <span class="n">firstnametextfieldTextField</span><span class="o">.</span><span class="nf">typeText</span><span class="p">(</span><span class="s">"wasin"</span><span class="p">)</span>

        <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">firstnametextfieldTextField</span><span class="o">.</span><span class="n">value</span> <span class="k">as!</span> <span class="kt">String</span> <span class="o">==</span> <span class="s">"wasin"</span><span class="p">)</span>

        <span class="c1">// take a snapshot</span>
        <span class="nf">snapshot</span><span class="p">(</span><span class="s">"usernameWasin"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">testLastnameIsThonkaew</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">lastnametextfieldTextField</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span><span class="o">.</span><span class="n">textFields</span><span class="p">[</span><span class="s">"lastNameTextField"</span><span class="p">]</span>
        <span class="n">lastnametextfieldTextField</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        <span class="n">lastnametextfieldTextField</span><span class="o">.</span><span class="nf">typeText</span><span class="p">(</span><span class="s">"thonkaew"</span><span class="p">)</span>

        <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">lastnametextfieldTextField</span><span class="o">.</span><span class="n">value</span> <span class="k">as!</span> <span class="kt">String</span> <span class="o">==</span> <span class="s">"thonkaew"</span><span class="p">)</span>

        <span class="c1">// take a snapshot</span>
        <span class="nf">snapshot</span><span class="p">(</span><span class="s">"lastnameWasin"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">testShowNewPage</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span>
        <span class="k">var</span> <span class="nv">backButton</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"backButton"</span><span class="p">]</span>
        <span class="c1">// backbutton should not exist</span>
        <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">backButton</span><span class="o">.</span><span class="n">exists</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">openButton</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"openButton"</span><span class="p">]</span>
        <span class="n">openButton</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>

        <span class="c1">// query back button again</span>
        <span class="n">backButton</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"backButton"</span><span class="p">]</span>
        <span class="c1">// check exists</span>
        <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">backButton</span><span class="o">.</span><span class="n">exists</span><span class="p">)</span>

        <span class="c1">// take a snapshot</span>
        <span class="nf">snapshot</span><span class="p">(</span><span class="s">"newpage"</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>
<p>You can notice above that why we know which name should be used in referring to text field, and buttons. This is the benefit from setting the names of UI element in <em>Accessibility</em> section of <em>Identify Inspector</em> panel.</p>

<p>You set following names</p>

<ul>
<li><code>firstNameTextField</code> - to first text field of first <code>UIViewController</code></li>
<li><code>lastNameTextField</code> - to second text field of first <code>UIViewController</code></li>
<li><code>openButton</code> - to open button of first <code>UIViewController</code></li>
<li><code>backButton</code> - to back button of second <code>UIViewController</code></li>
</ul>

<p>Also make sure that <em>Accessibility</em> is ticked as Enabled.</p>

<p><img src="/assets/images/fastlane/setting-names-in-accessibility.png" alt="setting names in accessibility"></p>

<p>This is important as it will allow us to access UI element in UI test code by name.</p>

<p>In additional, testing code is self-explained to what we&#39;re trying to achieve too. If you&#39;re not sure what it does, take some times, and read the code above.</p>

<h2 id="integrate-fastlane-with-xcode-project">Integrate Fastlane with XCode Project</h2>

<p>Now it&#39;s a core part.</p>

<p>We are going to initialize Fastlane tool, edit the configuration file, and run it to automate our workflow.</p>

<ul>
<li><p>Go to XCode project folder in command line via <code>cd ~/FastlaneTest</code>. This assumes that I&#39;ve created XCode project at <code>~/</code> which is my user directory. Inside <code>FastlaneTest</code> directory, you will see your <code>FastlaneTest.xcodeproj</code> file.</p></li>
<li><p>Execute <code>fastlane init</code> to initialize Fastlane.
This will create a directory <code>fastlane</code> at <code>~/FastlaneTest</code> with necessary files Fastlane needs inside.</p></li>
</ul>

<h3 id="fastfile">FastFile</h3>

<p>Time to configure <code>FastFile</code>.
As of version <code>2.5.0</code>, the initial configuration file covers most of the things we need already. We just need to modify and add something.</p>

<p>Add the following code inside <code>platform :ios do</code> after 
<code>before_all do ... end</code></p>
<div class="highlight"><pre><code class="language-python" data-lang="python">  <span class="n">desc</span> <span class="s">"Upload app to iTunes connect"</span>
  <span class="n">lane</span> <span class="p">:</span><span class="n">itunes</span> <span class="n">do</span>
    <span class="n">produce</span><span class="p">(</span>
        <span class="n">app_name</span><span class="p">:</span> <span class="s">'MyFastlaneTestApp'</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="s">'English'</span><span class="p">,</span>
        <span class="n">app_version</span><span class="p">:</span> <span class="s">'0.1'</span><span class="p">,</span>
        <span class="n">sku</span><span class="p">:</span> <span class="s">'c26e587b3fb756491e3c15aa'</span>
    <span class="p">)</span>
  <span class="n">end</span>

  <span class="n">desc</span> <span class="s">"Take screenshots of the App"</span>
  <span class="n">lane</span> <span class="p">:</span><span class="n">screenshots</span> <span class="n">do</span>
    <span class="n">snapshot</span>
  <span class="n">end</span>
</code></pre></div>
<blockquote>
<p>You can execute <code>openssl rand -hex 12</code> to get randomized hexadecimal string to use as <code>sku</code>.</p>
</blockquote>

<p>and modify <code>lane :beta</code> to be as follows</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">  <span class="n">desc</span> <span class="s">"Submit a new Beta Build to Apple TestFlight"</span>
  <span class="n">desc</span> <span class="s">"This will also make sure the profile is up to date"</span>
  <span class="n">lane</span> <span class="p">:</span><span class="n">beta</span> <span class="n">do</span>
    <span class="c"># match(type: "appstore") # more information: https://codesigning.guide</span>
    <span class="n">cert</span>
    <span class="n">sigh</span>
    <span class="n">gym</span> <span class="c"># Build your app - more options available</span>
    <span class="n">pilot</span>

    <span class="c"># sh "your_script.sh"</span>
    <span class="c"># You can also use other beta testing services here (run `fastlane actions`)</span>
  <span class="n">end</span>
</code></pre></div>
<p>Fastlane consists of multiple lanes to be configured and used. Notice <code>lane :&lt;name&gt;</code>.</p>

<ul>
<li><code>itunes</code> - create a new application on iTunes connect for us before we will release a new build for beta users, or submit to App Store.</li>
<li><code>screenshots</code> - take screenshots of application while running. This will be carried out at the same time of UI Tests.</li>
<li><code>beta</code> will submit a new beta build to TestFlight but it will also check certification and provision profile first that they are up-to-date.</li>
</ul>

<blockquote>
<p>If need, you can grab my <code>FastFile</code> <a href="https://gist.github.com/haxpor/a3c1da624c2256a138e5e6d0e48742c9">here</a>.</p>
</blockquote>

<h3 id="snapfile">Snapfile</h3>

<p>In order to take snapshot (or taking screenshots) of application while running automatically, you need to configure <code>Snapfile</code> but that file is not there inside <code>fastlane</code> directory initially.</p>

<p>We need to initialize it first by executing <code>fastlane snapshot init</code> at our XCode project directory (which is <code>~/FastlaneTest</code>.</p>

<p>It will create <code>Snapfile</code> for us, along with other setting up files. Result of executing such command, you will see</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">Successfully created SnapshotHelper.swift <span class="s1">'./fastlane/SnapshotHelper.swift'</span>
Successfully created new Snapfile at <span class="s1">'./fastlane/Snapfile'</span>
-------------------------------------------------------
Open your Xcode project and make sure to <span class="k">do </span>the following:
1<span class="o">)</span> Add a new UI Test target to your project
2<span class="o">)</span> Add the ./fastlane/SnapshotHelper.swift to your UI Test target
   You can move the file anywhere you want
3<span class="o">)</span> Call <span class="sb">`</span>setupSnapshot<span class="o">(</span>app<span class="o">)</span><span class="sb">`</span> when launching your app

  <span class="nb">let </span>app <span class="o">=</span> XCUIApplication<span class="o">()</span>
  setupSnapshot<span class="o">(</span>app<span class="o">)</span>
  app.launch<span class="o">()</span>

4<span class="o">)</span> Add <span class="sb">`</span>snapshot<span class="o">(</span><span class="s2">"0Launch"</span><span class="o">)</span><span class="sb">`</span> to wherever you want to create the screenshots

More information on GitHub: https://github.com/fastlane/fastlane/tree/master/snapshot
</code></pre></div>
<p>You need to follow step 2, and 3 as shown on console above to properly hook things UI Tests with taking screenshots. Notice that we&#39;ve already done step 1. We are going to do step 4 next.</p>

<p>Now modify the file to have the following code.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Uncomment the lines below you want to change by removing the # in the beginning</span>

<span class="c"># A list of devices you want to take the screenshots from</span>
<span class="n">devices</span><span class="p">([</span>
   <span class="s">"iPhone 6"</span><span class="p">,</span>
   <span class="s">"iPhone 6 Plus"</span><span class="p">,</span>
   <span class="s">"iPhone 5"</span><span class="p">,</span>
   <span class="s">"iPad Pro (12.9 inch)"</span>
<span class="c">#   "iPad Pro (9.7 inch)",</span>
<span class="c">#   "Apple TV 1080p"</span>
<span class="p">])</span>

<span class="n">languages</span><span class="p">([</span>
  <span class="s">"en-US"</span><span class="p">,</span>
  <span class="s">"fr-FR"</span><span class="p">,</span>
  <span class="s">"zh-Hans"</span>
  <span class="c">#["pt", "pt_BR"] # Portuguese with Brazilian locale</span>
<span class="p">])</span>

<span class="c"># The name of the scheme which contains the UI Tests</span>
<span class="n">scheme</span> <span class="s">"FastlaneTestUITests"</span>

<span class="c"># Where should the resulting screenshots be stored?</span>
<span class="n">output_directory</span> <span class="s">"./screenshots"</span>

<span class="n">clear_previous_screenshots</span> <span class="n">true</span> <span class="c"># remove the '#' to clear all previously generated screenshots before creating new ones</span>

<span class="c"># Choose which project/workspace to use</span>
<span class="n">project</span> <span class="s">"./FastlaneTest.xcodeproj"</span>
<span class="c"># workspace "./Project.xcworkspace"</span>

<span class="c"># Arguments to pass to the app on launch. See https://github.com/fastlane/snapshot#launch-arguments</span>
<span class="c"># launch_arguments(["-favColor red"])</span>

<span class="c"># For more information about all available options run</span>
<span class="c"># snapshot --help</span>

</code></pre></div>
<p>That means we will do UI Tests (thus taking screenshots) on 4 devices for 3 languages for scheme name <code>FastlaneTestUITests</code>, and output result screenshots at <code>./screenshots</code>. It operates on our <code>./FastlaneTest.xcodeproj</code> file.</p>

<blockquote>
<p>If need, you can grab my <code>Snapfile</code> <a href="https://gist.github.com/haxpor/54e82fdb1c8d6f574ee69f129867496e">here</a>.</p>
</blockquote>

<h2 id="run-fastlane">Run Fastlane</h2>

<p>We&#39;re all ready now. Phew! It&#39;s quite an effort.
Now we&#39;re going to run Fastlane.</p>

<p>We have following commands (lanes) for Fastlane to run.</p>

<ul>
<li><code>fastlane itunes</code> - create application on iTunes Connect Website according to basic information we provide.</li>
<li><code>fastlane test</code> - test application. It will prompt you with options to choose from whether you want to just test running application, run tests, or run ui tests.</li>
<li><code>fastlane screenshot</code> - take screenshots as well as running UI Tests at the same time. Screenshots will be writen into <code>screenshots</code> directory inside XCode project directory.</li>
<li><code>fastlane beta</code> - submit an application to beta TestFlight. It will take care certificate and provisioning profile for us too.</li>
</ul>

<h2 id="results">Results</h2>

<ul>
<li><code>fastlane itunes</code> is good enough that it will wait until application data is created on iTunes Connect website<br></li>
</ul>

<p><img src="/assets/images/fastlane/fastlane-itunes-result.png" alt="fastlane itunes waiting"></p>

<ul>
<li><code>fastlane screenshots</code> will run UI Tests and take screenshots. Look inside <code>screenshots</code> directory inside XCode project directory, you will see 3 directories for each language we&#39;ve set. Result screenshots are there.<br></li>
</ul>

<p><img src="/assets/images/fastlane/fastlane-screenshots.png" alt="fastlane screenshots"></p>

<p><img src="/assets/images/fastlane/fastlane-screenshots-result.png" alt="fastlane ui tests result"></p>

<p>See its overall reporting of screenshots taken specifically at 3 particular times during flow of UI on iPhone5 (4-inch), iPhone6(4.7-inch), iPhone6Plus(5.5-inch), and iPad Pro(12.9-inch) each with 3 languages on latest iOS 10.2; total in 3x3x4=36 screenshots <a href="/assets/htmls/fastlane-screenshots/screenshots.html">here</a>.</p>

<ul>
<li><code>fastlane beta</code> while uploading a build to TestFlight<br></li>
</ul>

<p><img src="/assets/images/fastlane/fastlane-beta-testing-upload.png" alt="fastlane TestFlight uploading"></p>

<p>and successfully uploaded application during beta testing stage</p>

<p><img src="/assets/images/fastlane/fastlane-beta-testing-upload.png" alt="fastlane application on TestFlight app"></p>

<ul>
<li><code>fastlane test</code> result<br></li>
</ul>

<p><img src="/assets/images/fastlane/ui-tests-result.png" alt="fastlane test result"></p>

<ul>
<li><code>fastlane test</code> in action<br></li>
</ul>

<p><img src="/assets/images/fastlane/ui-tests.gif" alt="fastlane test in action"></p>

<h2 id="whats-next">What&#39;s Next?</h2>

<p>We can put all those commands into a shell script file thus to be executed on build server as part of CI process. I believe this will let developers sit back and be more productive on making application, not to waste time on tasks that can be automated.</p>

<p>Thus next step is to review and see which existing tech stack the team currently has, then integrate &amp; modify Fastlane to suit the need and use case.</p>

  </article>

  
  	<span class="post-tags">Tags</span>:
  	automation, fastlane, integration, ios, script
	

  
<div id="disqus_thread" style="margin-top: 30px;"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
this.page.url = "http://blog.wasin.io/blog/2017/01/15/hands-on-fastlane.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/blog/2017/01/15/hands-on-fastlane"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://wasin-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>

      </div>
    </div>

    <hr style="width:70%;margin: auto;border: 0; height: 0; border-top:1px solid rgba(0, 0, 0, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.3);"> 

    <div style="max-width: 500px;margin: 30px auto;display:block;">
  <form id="emailSubForm" style="text-align: center; background-color: whitesmoke; border:1px solid #ccc;padding:15px 3px;text-align:center;border-radius:10px;margin-left: 8px;margin-right: 8px" action="https://tinyletter.com/haxpor" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/haxpor', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p><label for="tlemail" style="font-size:22px">Enter your email address</label></p>
    <p><input type="text" style="width:200px;padding: 10px 10px;font-size:22px" name="email" id="tlemail"></p>
    <input type="hidden" value="1" name="embed"><a style="cursor: pointer;width:70%;color:white" class="weui-btn weui-btn_warn" onclick="document.getElementById('emailSubForm').submit();">Subscribe</a>
  </form>
</div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Wasin's Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Wasin's Blog</li>
          <li><a href="mailto:haxpor@gmail.com">haxpor@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/haxpor">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/haxpor">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://instagram.com/haxpor">
              <span class="icon  icon--instagram">
                <svg viewBox="0 0 512 512">
                  <g>
                    <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/>
                    <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/>
                    <circle cx="351.5" cy="160.5" r="21.5"/>
                  </g>
                </svg>
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
          

          <li>
            <a href="/feed.xml">
              <span class="icon" style="text-align: center">
                <img class="normal" src="/assets/images/sites/rss-feed-icon.png" width="32px">
              </span>

              <span class="username">haxpor</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">I blog about projects I'm working on. Mostly about mobile games, tech, web service, little tiny things I built for myself or for public, and tech/game industry-wide. Currently I'm living in Shenzhen, China. I'm running a small creative company with my girlfriend here.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>
</html>
